<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>TALKCA • Finance + Data + Intelligence</title>
  <link rel="stylesheet" href="assets/site.css">
  <style>
    .thumb-img {
      width: 100%;
      height: 172px;
      object-fit: cover;
      border-bottom: 1px solid rgba(30,42,74,.7);
    }
    .thumb-img-large {
      width: 100%;
      height: 240px;
      object-fit: cover;
      border-bottom: 1px solid rgba(30,42,74,.7);
    }
    .thumb-overlay {
      position: relative;
    }
    .thumb-overlay .thumb-badges {
      position: absolute;
      bottom: 12px;
      left: 12px;
      right: 12px;
      display: flex;
      justify-content: space-between;
      align-items: flex-end;
    }
    .play-icon {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 68px;
      height: 48px;
      background: rgba(255,0,0,0.9);
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s;
    }
    .play-icon::after {
      content: "";
      border-style: solid;
      border-width: 10px 0 10px 18px;
      border-color: transparent transparent transparent white;
      margin-left: 3px;
    }
    .videoCard:hover .play-icon {
      background: rgba(255,0,0,1);
      transform: translate(-50%, -50%) scale(1.1);
    }
    .suggested-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 14px;
    }
    @media (max-width: 980px) { .suggested-grid { grid-template-columns: repeat(2, 1fr); } }
    @media (max-width: 620px) { .suggested-grid { grid-template-columns: 1fr; } }
  </style>
</head>
<body>

<header class="topbar">
  <div class="brand">
    <div class="mark">T</div>
    <div>
      <h1>TALKCA</h1>
      <small>Finance • Data • Intelligence</small>
    </div>
  </div>
  <nav class="nav">
    <a class="active" href="index.html">Home</a>
    <a href="explainers.html">Explainers</a>
    <a href="shorts.html">Shorts</a>
  </nav>
</header>

<main class="container">

  <section class="hero">
    <div id="featuredVideo" class="card videoCard">
      <div class="thumb"><span class="badge">Loading...</span></div>
      <div class="vBody">
        <div class="kicker">Latest Focus</div>
        <h2 class="h-title">Loading...</h2>
        <p class="p">Loading content...</p>
      </div>
    </div>

    <aside class="card pad">
      <div class="kicker">Browse</div>
      <h2 style="margin:10px 0 8px; font-size:18px;">Topics</h2>
      <p class="p">Filter by category</p>
      <div class="metaRow" style="margin-top:14px;">
        <span class="pill">Inflation</span>
        <span class="pill">Currency</span>
        <span class="pill">GDP & Rankings</span>
        <span class="pill">Markets</span>
        <span class="pill">Personal Finance</span>
      </div>
      <div class="searchRow">
        <input class="input" id="searchInput" placeholder="Search titles..." oninput="filterContent()" />
        <select class="select" id="typeFilter" onchange="filterContent()">
          <option value="all">All</option>
          <option value="long">Long</option>
          <option value="short">Short</option>
        </select>
      </div>
      <div class="actions">
        <a class="btn" href="explainers.html">See all explainers</a>
        <a class="btn" href="shorts.html">See all shorts</a>
      </div>
    </aside>
  </section>

  <div class="sectionTitle">
    <h2>Suggested Videos</h2>
    <a href="explainers.html">View all</a>
  </div>
  <section id="suggestedVideos" class="suggested-grid"></section>

  <div class="sectionTitle">
    <h2>Latest Shorts</h2>
    <a href="shorts.html">View all</a>
  </div>
  <section id="latestShorts" class="cards"></section>

  <footer class="footer">
    <div>© <span id="y"></span> TALKCA • Finance • Data • Intelligence</div>
    <div style="display:flex; gap:10px; flex-wrap:wrap;">
      <a class="pill" href="https://www.youtube.com/" target="_blank" rel="noopener">YouTube</a>
      <a class="pill" href="#" target="_blank" rel="noopener">Instagram</a>
      <a class="pill" href="#" target="_blank" rel="noopener">X</a>
    </div>
  </footer>

</main>

<script>
let allVideos = [];

function getYouTubeId(url) {
  if (!url) return null;
  const patterns = [
    /(?:youtube\.com\/watch\?v=|youtu\.be\/|youtube\.com\/embed\/|youtube\.com\/shorts\/)([^&\?\/]+)/,
    /^([a-zA-Z0-9_-]{11})$/
  ];
  for (const pattern of patterns) {
    const match = url.match(pattern);
    if (match) return match[1];
  }
  return null;
}

function getThumbnail(url) {
  const videoId = getYouTubeId(url);
  if (videoId) {
    return `https://img.youtube.com/vi/${videoId}/hqdefault.jpg`;
  }
  return null;
}

async function loadVideos() {
  const localData = localStorage.getItem('talkca_videos');
  if (localData) {
    allVideos = JSON.parse(localData);
    renderPage();
    return;
  }
  try {
    const response = await fetch('data/videos.json');
    if (response.ok) {
      allVideos = await response.json();
      localStorage.setItem('talkca_videos', JSON.stringify(allVideos));
    }
  } catch (e) {
    allVideos = [];
  }
  renderPage();
}

function renderPage() {
  renderFeatured();
  renderSuggested();
  renderLatestShorts();
}

function renderFeatured() {
  const featured = allVideos.find(v => v.featured) || allVideos[0];
  if (!featured) return;
  
  const container = document.getElementById('featuredVideo');
  const typeLabel = featured.type === 'long' ? 'Long' : 'Short';
  const thumbnail = getThumbnail(featured.url);
  
  let thumbHTML;
  if (thumbnail) {
    thumbHTML = `
      <div class="thumb-overlay">
        <img src="${thumbnail}" alt="${featured.title}" class="thumb-img-large">
        <div class="play-icon"></div>
        <div class="thumb-badges">
          <span class="badge">Featured • ${typeLabel}</span>
          <span class="pill">${featured.duration || '5-10 min'}</span>
        </div>
      </div>
    `;
  } else {
    thumbHTML = `
      <div class="thumb" style="height:240px;">
        <span class="badge">Featured • ${typeLabel}</span>
        <span class="pill">${featured.duration || '5-10 min'}</span>
      </div>
    `;
  }
  
  container.innerHTML = `
    <a href="video.html?id=${featured.id}" style="text-decoration:none; color:inherit; display:block;">
      ${thumbHTML}
      <div class="vBody">
        <div class="kicker">Latest Focus</div>
        <h2 class="h-title">${featured.title}</h2>
        <p class="p">${featured.description}</p>
        <div class="metaRow">
          <span class="pill">Topic: ${featured.topic}</span>
          <span class="pill">${featured.date}</span>
        </div>
      </div>
    </a>
  `;
}

function renderSuggested() {
  const featured = allVideos.find(v => v.featured) || allVideos[0];
  const suggested = allVideos
    .filter(v => v.type === 'long' && v.id !== (featured ? featured.id : ''))
    .sort((a, b) => new Date(b.date) - new Date(a.date))
    .slice(0, 4);
  
  const container = document.getElementById('suggestedVideos');
  
  if (suggested.length === 0) {
    container.innerHTML = '<p class="note">No suggested videos yet.</p>';
    return;
  }
  
  container.innerHTML = suggested.map(video => createVideoCard(video)).join('');
}

function renderLatestShorts() {
  const shorts = allVideos
    .filter(v => v.type === 'short')
    .sort((a, b) => new Date(b.date) - new Date(a.date))
    .slice(0, 3);
  
  const container = document.getElementById('latestShorts');
  
  if (shorts.length === 0) {
    container.innerHTML = '<p class="note">No shorts yet.</p>';
    return;
  }
  
  container.innerHTML = shorts.map(video => createVideoCard(video)).join('');
}

function createVideoCard(video) {
  const badgeClass = video.type === 'short' ? 'badge short' : 'badge';
  const badgeText = video.type === 'short' ? 'Short' : 'Long';
  const thumbnail = getThumbnail(video.url);
  
  let thumbHTML;
  if (thumbnail) {
    thumbHTML = `
      <div class="thumb-overlay">
        <img src="${thumbnail}" alt="${video.title}" class="thumb-img">
        <div class="play-icon"></div>
        <div class="thumb-badges">
          <span class="${badgeClass}">${badgeText}</span>
        </div>
      </div>
    `;
  } else {
    thumbHTML = `<div class="thumb"><span class="${badgeClass}">${badgeText}</span></div>`;
  }
  
  return `
    <a class="card videoCard" href="video.html?id=${video.id}">
      ${thumbHTML}
      <div class="vBody">
        <h3>${video.title}</h3>
        <p>${video.description}</p>
      </div>
    </a>
  `;
}

function filterContent() {
  const query = document.getElementById('searchInput').value.toLowerCase();
  const type = document.getElementById('typeFilter').value;
  let filtered = allVideos;
  if (type !== 'all') filtered = filtered.filter(v => v.type === type);
  if (query) filtered = filtered.filter(v => v.title.toLowerCase().includes(query) || v.description.toLowerCase().includes(query));
  
  const featured = allVideos.find(v => v.featured) || allVideos[0];
  const suggested = filtered.filter(v => v.type === 'long' && v.id !== (featured ? featured.id : '')).slice(0, 4);
  const shorts = filtered.filter(v => v.type === 'short').slice(0, 3);
  
  document.getElementById('suggestedVideos').innerHTML = suggested.length ? suggested.map(v => createVideoCard(v)).join('') : '<p class="note">No videos found.</p>';
  document.getElementById('latestShorts').innerHTML = shorts.length ? shorts.map(v => createVideoCard(v)).join('') : '<p class="note">No shorts found.</p>';
}

document.getElementById('y').textContent = new Date().getFullYear();
loadVideos();
</script>
</body>
</html>
