<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>TALKCA • Admin</title>
  <link rel="stylesheet" href="assets/site.css">
  <style>
    .admin-login, .admin-panel { max-width: 560px; margin: 60px auto; }
    .admin-panel { max-width: 780px; }
    .form-group { margin-bottom: 16px; }
    .form-group label {
      display: block;
      color: var(--muted);
      font-size: 13px;
      margin-bottom: 6px;
      letter-spacing: .3px;
    }
    .form-group input,
    .form-group select,
    .form-group textarea {
      width: 100%;
      padding: 12px 14px;
      border-radius: 12px;
      border: 1px solid rgba(30,42,74,.75);
      background: rgba(10,16,32,.7);
      color: var(--text);
      font-family: inherit;
      font-size: 14px;
      outline: none;
      transition: border-color .2s;
    }
    .form-group input:focus,
    .form-group select:focus,
    .form-group textarea:focus {
      border-color: rgba(255,211,106,.5);
    }
    .form-group textarea { min-height: 100px; resize: vertical; }
    .form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
    @media (max-width: 600px) { .form-row { grid-template-columns: 1fr; } }
    
    .error-msg {
      background: rgba(255,100,100,.15);
      border: 1px solid rgba(255,100,100,.3);
      color: #ff9999;
      padding: 12px 14px;
      border-radius: 12px;
      margin-bottom: 16px;
      display: none;
    }
    .success-msg {
      background: rgba(124,255,178,.1);
      border: 1px solid rgba(124,255,178,.3);
      color: var(--ok);
      padding: 12px 14px;
      border-radius: 12px;
      margin-bottom: 16px;
      display: none;
    }
    
    .video-list { margin-top: 24px; }
    .video-item {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      padding: 14px 16px;
      border: 1px solid rgba(30,42,74,.6);
      border-radius: 12px;
      margin-bottom: 10px;
      background: rgba(10,16,32,.5);
    }
    .video-item-info h4 { margin: 0 0 4px; font-size: 14px; }
    .video-item-info span { font-size: 12px; color: var(--muted); }
    .video-item-actions { display: flex; gap: 8px; }
    .btn-small {
      padding: 8px 12px;
      font-size: 12px;
      border-radius: 10px;
    }
    .btn-danger { border-color: rgba(255,100,100,.4); color: #ff9999; }
    .btn-danger:hover { border-color: rgba(255,100,100,.6); background: rgba(255,100,100,.1); }
    
    .tabs {
      display: flex;
      gap: 8px;
      margin-bottom: 20px;
      border-bottom: 1px solid rgba(30,42,74,.6);
      padding-bottom: 12px;
    }
    .tab {
      padding: 10px 16px;
      border-radius: 10px;
      cursor: pointer;
      color: var(--muted);
      border: 1px solid transparent;
      transition: all .2s;
    }
    .tab:hover { color: var(--text); }
    .tab.active {
      color: var(--text);
      background: rgba(255,211,106,.1);
      border-color: rgba(255,211,106,.3);
    }
    .tab-content { display: none; }
    .tab-content.active { display: block; }
    
    .featured-badge {
      display: inline-block;
      padding: 4px 8px;
      background: rgba(255,211,106,.15);
      border: 1px solid rgba(255,211,106,.3);
      border-radius: 6px;
      font-size: 10px;
      color: var(--accent);
      text-transform: uppercase;
      letter-spacing: .5px;
      margin-left: 8px;
    }
    
    .export-section {
      margin-top: 30px;
      padding-top: 20px;
      border-top: 1px solid rgba(30,42,74,.5);
    }
    .code-output {
      background: rgba(7,11,20,.8);
      border: 1px solid rgba(30,42,74,.7);
      border-radius: 12px;
      padding: 16px;
      font-family: var(--mono);
      font-size: 12px;
      color: var(--muted);
      max-height: 300px;
      overflow: auto;
      white-space: pre-wrap;
      word-break: break-all;
    }
  </style>
</head>
<body>

<header class="topbar">
  <div class="brand">
    <div class="mark">T</div>
    <div>
      <h1>TALKCA</h1>
      <small>Admin Panel</small>
    </div>
  </div>
  <nav class="nav">
    <a href="index.html">Home</a>
    <a href="explainers.html">Explainers</a>
    <a href="shorts.html">Shorts</a>
    <a class="active" href="admin.html">Admin</a>
  </nav>
</header>

<main class="container">

  <!-- LOGIN SCREEN -->
  <section id="loginScreen" class="admin-login">
    <div class="card pad">
      <div class="kicker">Admin Access</div>
      <h2 style="margin:10px 0 6px; font-size:22px;">Sign In</h2>
      <p class="p" style="margin-bottom:20px;">Enter your admin password to manage content.</p>
      
      <div id="loginError" class="error-msg">Incorrect password. Try again.</div>
      
      <div class="form-group">
        <label>Password</label>
        <input type="password" id="passwordInput" placeholder="Enter admin password" />
      </div>
      
      <button class="btn primary" onclick="attemptLogin()" style="width:100%;">
        Sign In
      </button>
      
      <div class="note" style="margin-top:16px;">
        <strong>Default password:</strong> <code>talkca2026</code><br>
        Change this in the admin.html file before going live.
      </div>
    </div>
  </section>

  <!-- ADMIN PANEL (hidden until login) -->
  <section id="adminPanel" class="admin-panel" style="display:none;">
    
    <div class="card pad">
      <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:16px;">
        <div>
          <div class="kicker">Content Manager</div>
          <h2 style="margin:6px 0 0; font-size:20px;">Add & Manage Videos</h2>
        </div>
        <button class="btn" onclick="logout()">Sign Out</button>
      </div>
      
      <div class="tabs">
        <div class="tab active" onclick="switchTab('add')">Add New</div>
        <div class="tab" onclick="switchTab('manage')">Manage Videos</div>
        <div class="tab" onclick="switchTab('export')">Export Data</div>
      </div>
      
      <!-- ADD NEW VIDEO TAB -->
      <div id="tab-add" class="tab-content active">
        <div id="addSuccess" class="success-msg">Video added successfully!</div>
        <div id="addError" class="error-msg">Please fill in all required fields.</div>
        
        <div class="form-group">
          <label>Video Title *</label>
          <input type="text" id="videoTitle" placeholder="e.g., The $1 Salary Problem: When Money Stops Working" />
        </div>
        
        <div class="form-group">
          <label>YouTube URL *</label>
          <input type="url" id="videoUrl" placeholder="https://www.youtube.com/watch?v=..." />
        </div>
        
        <div class="form-row">
          <div class="form-group">
            <label>Type *</label>
            <select id="videoType">
              <option value="long">Explainer (Long)</option>
              <option value="short">Short</option>
            </select>
          </div>
          <div class="form-group">
            <label>Topic *</label>
            <select id="videoTopic">
              <option value="Inflation">Inflation</option>
              <option value="Currency">Currency</option>
              <option value="GDP & Rankings">GDP & Rankings</option>
              <option value="Markets">Markets</option>
              <option value="Personal Finance">Personal Finance</option>
            </select>
          </div>
        </div>
        
        <div class="form-row">
          <div class="form-group">
            <label>Duration</label>
            <input type="text" id="videoDuration" placeholder="e.g., 8-10 min or 60 sec" />
          </div>
          <div class="form-group">
            <label>Publish Date</label>
            <input type="date" id="videoDate" />
          </div>
        </div>
        
        <div class="form-group">
          <label>Short Description *</label>
          <textarea id="videoDesc" placeholder="A brief description that appears on video cards..."></textarea>
        </div>
        
        <div class="form-group">
          <label>
            <input type="checkbox" id="videoFeatured" style="width:auto; margin-right:8px;" />
            Set as Featured Video (appears in hero section)
          </label>
        </div>
        
        <button class="btn primary" onclick="addVideo()" style="width:100%; margin-top:8px;">
          Add Video
        </button>
      </div>
      
      <!-- MANAGE VIDEOS TAB -->
      <div id="tab-manage" class="tab-content">
        <div class="form-row" style="margin-bottom:16px;">
          <div class="form-group" style="margin-bottom:0;">
            <select id="filterType" onchange="renderVideoList()">
              <option value="all">All Types</option>
              <option value="long">Explainers Only</option>
              <option value="short">Shorts Only</option>
            </select>
          </div>
          <div class="form-group" style="margin-bottom:0;">
            <input type="text" id="searchVideos" placeholder="Search titles..." oninput="renderVideoList()" />
          </div>
        </div>
        
        <div id="videoList" class="video-list">
          <!-- Videos will be rendered here -->
        </div>
        
        <div class="note">Click "Edit" to modify a video or "Delete" to remove it.</div>
      </div>
      
      <!-- EXPORT TAB -->
      <div id="tab-export" class="tab-content">
        <p class="p" style="margin-bottom:16px;">
          Copy this JSON data to update your website. Paste it into <code>data/videos.json</code> in your GitHub repository.
        </p>
        
        <div class="actions" style="margin-bottom:16px;">
          <button class="btn primary" onclick="copyExport()">Copy to Clipboard</button>
          <button class="btn" onclick="downloadExport()">Download JSON File</button>
        </div>
        
        <div id="exportOutput" class="code-output"></div>
        
        <div class="export-section">
          <div class="kicker" style="margin-bottom:8px;">Import Data</div>
          <p class="p" style="margin-bottom:12px;">Paste existing JSON data to restore your video library.</p>
          <textarea id="importData" placeholder='Paste your videos.json content here...' style="width:100%; min-height:80px; margin-bottom:12px; padding:12px; border-radius:12px; border:1px solid rgba(30,42,74,.75); background:rgba(10,16,32,.7); color:var(--text); font-family:var(--mono); font-size:12px;"></textarea>
          <button class="btn" onclick="importVideos()">Import Data</button>
        </div>
      </div>
      
    </div>
    
  </section>

</main>

<!-- EDIT MODAL -->
<div id="editModal" style="display:none; position:fixed; inset:0; background:rgba(7,11,20,.9); z-index:100; overflow:auto; padding:40px 20px;">
  <div class="card pad" style="max-width:600px; margin:0 auto;">
    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
      <h2 style="margin:0; font-size:18px;">Edit Video</h2>
      <button class="btn btn-small" onclick="closeEditModal()">Cancel</button>
    </div>
    
    <div class="form-group">
      <label>Video Title</label>
      <input type="text" id="editTitle" />
    </div>
    
    <div class="form-group">
      <label>YouTube URL</label>
      <input type="url" id="editUrl" />
    </div>
    
    <div class="form-row">
      <div class="form-group">
        <label>Type</label>
        <select id="editType">
          <option value="long">Explainer (Long)</option>
          <option value="short">Short</option>
        </select>
      </div>
      <div class="form-group">
        <label>Topic</label>
        <select id="editTopic">
          <option value="Inflation">Inflation</option>
          <option value="Currency">Currency</option>
          <option value="GDP & Rankings">GDP & Rankings</option>
          <option value="Markets">Markets</option>
          <option value="Personal Finance">Personal Finance</option>
        </select>
      </div>
    </div>
    
    <div class="form-row">
      <div class="form-group">
        <label>Duration</label>
        <input type="text" id="editDuration" />
      </div>
      <div class="form-group">
        <label>Publish Date</label>
        <input type="date" id="editDate" />
      </div>
    </div>
    
    <div class="form-group">
      <label>Short Description</label>
      <textarea id="editDesc"></textarea>
    </div>
    
    <div class="form-group">
      <label>
        <input type="checkbox" id="editFeatured" style="width:auto; margin-right:8px;" />
        Set as Featured Video
      </label>
    </div>
    
    <input type="hidden" id="editIndex" />
    
    <button class="btn primary" onclick="saveEdit()" style="width:100%;">Save Changes</button>
  </div>
</div>

<script>
// ============================================
// CONFIGURATION
// ============================================
const ADMIN_PASSWORD = 'talkca2026'; // CHANGE THIS before going live!

// ============================================
// DATA STORAGE (localStorage for now)
// ============================================
function getVideos() {
  const data = localStorage.getItem('talkca_videos');
  if (data) {
    return JSON.parse(data);
  }
  // Default sample data
  return [
    {
      id: 'v1',
      title: 'The $1 Salary Problem: When Money Stops Working',
      url: 'https://www.youtube.com/',
      type: 'long',
      topic: 'Inflation',
      duration: '8-10 min',
      date: '2026-01-08',
      description: 'A clean breakdown of how inflation, controls, and currency collapse destroy purchasing power — explained with numbers and visuals.',
      featured: true
    },
    {
      id: 'v2',
      title: 'Why Prices Rise Faster Than Salaries',
      url: 'https://www.youtube.com/',
      type: 'long',
      topic: 'Inflation',
      duration: '7 min',
      date: '2026-01-05',
      description: 'Purchasing power explained with a simple, visual model.',
      featured: false
    },
    {
      id: 'v3',
      title: 'Currency Collapse: The 3 Signals Everyone Misses',
      url: 'https://www.youtube.com/',
      type: 'long',
      topic: 'Currency',
      duration: '9 min',
      date: '2026-01-03',
      description: 'Reserves, confidence, and the black-market premium.',
      featured: false
    },
    {
      id: 'v4',
      title: '1 Trillion Can\'t Buy Food',
      url: 'https://www.youtube.com/',
      type: 'short',
      topic: 'Currency',
      duration: '45 sec',
      date: '2026-01-07',
      description: 'When currency becomes paper.',
      featured: false
    },
    {
      id: 'v5',
      title: 'Inflation vs You (10 seconds)',
      url: 'https://www.youtube.com/',
      type: 'short',
      topic: 'Inflation',
      duration: '10 sec',
      date: '2026-01-06',
      description: 'The silent tax explained fast.',
      featured: false
    }
  ];
}

function saveVideos(videos) {
  localStorage.setItem('talkca_videos', JSON.stringify(videos));
}

// ============================================
// AUTHENTICATION
// ============================================
function attemptLogin() {
  const password = document.getElementById('passwordInput').value;
  if (password === ADMIN_PASSWORD) {
    sessionStorage.setItem('talkca_admin', 'true');
    showAdminPanel();
  } else {
    document.getElementById('loginError').style.display = 'block';
  }
}

function logout() {
  sessionStorage.removeItem('talkca_admin');
  location.reload();
}

function showAdminPanel() {
  document.getElementById('loginScreen').style.display = 'none';
  document.getElementById('adminPanel').style.display = 'block';
  renderVideoList();
  updateExport();
}

function checkAuth() {
  if (sessionStorage.getItem('talkca_admin') === 'true') {
    showAdminPanel();
  }
}

// ============================================
// TAB NAVIGATION
// ============================================
function switchTab(tabName) {
  document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
  document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
  
  event.target.classList.add('active');
  document.getElementById('tab-' + tabName).classList.add('active');
  
  if (tabName === 'export') updateExport();
  if (tabName === 'manage') renderVideoList();
}

// ============================================
// ADD VIDEO
// ============================================
function addVideo() {
  const title = document.getElementById('videoTitle').value.trim();
  const url = document.getElementById('videoUrl').value.trim();
  const type = document.getElementById('videoType').value;
  const topic = document.getElementById('videoTopic').value;
  const duration = document.getElementById('videoDuration').value.trim();
  const date = document.getElementById('videoDate').value;
  const description = document.getElementById('videoDesc').value.trim();
  const featured = document.getElementById('videoFeatured').checked;
  
  // Validation
  if (!title || !url || !description) {
    document.getElementById('addError').style.display = 'block';
    document.getElementById('addSuccess').style.display = 'none';
    return;
  }
  
  const videos = getVideos();
  
  // If marking as featured, unfeature others
  if (featured) {
    videos.forEach(v => v.featured = false);
  }
  
  // Add new video
  videos.unshift({
    id: 'v' + Date.now(),
    title,
    url,
    type,
    topic,
    duration: duration || (type === 'long' ? '5-10 min' : '30 sec'),
    date: date || new Date().toISOString().split('T')[0],
    description,
    featured
  });
  
  saveVideos(videos);
  
  // Clear form
  document.getElementById('videoTitle').value = '';
  document.getElementById('videoUrl').value = '';
  document.getElementById('videoDuration').value = '';
  document.getElementById('videoDate').value = '';
  document.getElementById('videoDesc').value = '';
  document.getElementById('videoFeatured').checked = false;
  
  // Show success
  document.getElementById('addSuccess').style.display = 'block';
  document.getElementById('addError').style.display = 'none';
  
  setTimeout(() => {
    document.getElementById('addSuccess').style.display = 'none';
  }, 3000);
}

// ============================================
// MANAGE VIDEOS
// ============================================
function renderVideoList() {
  const videos = getVideos();
  const filterType = document.getElementById('filterType').value;
  const searchQuery = document.getElementById('searchVideos').value.toLowerCase();
  
  let filtered = videos;
  
  if (filterType !== 'all') {
    filtered = filtered.filter(v => v.type === filterType);
  }
  
  if (searchQuery) {
    filtered = filtered.filter(v => v.title.toLowerCase().includes(searchQuery));
  }
  
  const container = document.getElementById('videoList');
  
  if (filtered.length === 0) {
    container.innerHTML = '<p class="note">No videos found.</p>';
    return;
  }
  
  container.innerHTML = filtered.map((video, idx) => {
    const originalIdx = videos.findIndex(v => v.id === video.id);
    return `
      <div class="video-item">
        <div class="video-item-info">
          <h4>
            ${video.title}
            ${video.featured ? '<span class="featured-badge">Featured</span>' : ''}
          </h4>
          <span>${video.type === 'long' ? 'Explainer' : 'Short'} • ${video.topic} • ${video.date}</span>
        </div>
        <div class="video-item-actions">
          <button class="btn btn-small" onclick="editVideo(${originalIdx})">Edit</button>
          <button class="btn btn-small btn-danger" onclick="deleteVideo(${originalIdx})">Delete</button>
        </div>
      </div>
    `;
  }).join('');
}

function deleteVideo(index) {
  if (!confirm('Are you sure you want to delete this video?')) return;
  
  const videos = getVideos();
  videos.splice(index, 1);
  saveVideos(videos);
  renderVideoList();
}

// ============================================
// EDIT VIDEO
// ============================================
function editVideo(index) {
  const videos = getVideos();
  const video = videos[index];
  
  document.getElementById('editTitle').value = video.title;
  document.getElementById('editUrl').value = video.url;
  document.getElementById('editType').value = video.type;
  document.getElementById('editTopic').value = video.topic;
  document.getElementById('editDuration').value = video.duration;
  document.getElementById('editDate').value = video.date;
  document.getElementById('editDesc').value = video.description;
  document.getElementById('editFeatured').checked = video.featured;
  document.getElementById('editIndex').value = index;
  
  document.getElementById('editModal').style.display = 'block';
}

function closeEditModal() {
  document.getElementById('editModal').style.display = 'none';
}

function saveEdit() {
  const index = parseInt(document.getElementById('editIndex').value);
  const videos = getVideos();
  
  const featured = document.getElementById('editFeatured').checked;
  
  // If marking as featured, unfeature others
  if (featured) {
    videos.forEach(v => v.featured = false);
  }
  
  videos[index] = {
    ...videos[index],
    title: document.getElementById('editTitle').value.trim(),
    url: document.getElementById('editUrl').value.trim(),
    type: document.getElementById('editType').value,
    topic: document.getElementById('editTopic').value,
    duration: document.getElementById('editDuration').value.trim(),
    date: document.getElementById('editDate').value,
    description: document.getElementById('editDesc').value.trim(),
    featured
  };
  
  saveVideos(videos);
  closeEditModal();
  renderVideoList();
}

// ============================================
// EXPORT / IMPORT
// ============================================
function updateExport() {
  const videos = getVideos();
  document.getElementById('exportOutput').textContent = JSON.stringify(videos, null, 2);
}

function copyExport() {
  const text = document.getElementById('exportOutput').textContent;
  navigator.clipboard.writeText(text).then(() => {
    alert('Copied to clipboard!');
  });
}

function downloadExport() {
  const videos = getVideos();
  const blob = new Blob([JSON.stringify(videos, null, 2)], { type: 'application/json' });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = 'videos.json';
  a.click();
  URL.revokeObjectURL(url);
}

function importVideos() {
  const data = document.getElementById('importData').value.trim();
  if (!data) {
    alert('Please paste JSON data first.');
    return;
  }
  
  try {
    const videos = JSON.parse(data);
    if (!Array.isArray(videos)) throw new Error('Invalid format');
    saveVideos(videos);
    alert('Data imported successfully!');
    renderVideoList();
    updateExport();
    document.getElementById('importData').value = '';
  } catch (e) {
    alert('Invalid JSON format. Please check your data.');
  }
}

// ============================================
// INIT
// ============================================
document.addEventListener('DOMContentLoaded', () => {
  checkAuth();
  document.getElementById('videoDate').value = new Date().toISOString().split('T')[0];
  
  // Allow Enter key on passwor
