<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>TALKCA • Finance + Data + Intelligence</title>
  <link rel="stylesheet" href="assets/site.css">
</head>
<body>

<header class="topbar">
  <div class="brand">
    <div class="mark">T</div>
    <div>
      <h1>TALKCA</h1>
      <small>Finance • Data • Intelligence</small>
    </div>
  </div>
  <nav class="nav">
    <a class="active" href="index.html">Home</a>
    <a href="explainers.html">Explainers</a>
    <a href="shorts.html">Shorts</a>
  </nav>
</header>

<main class="container">

  <!-- HERO: Featured video -->
  <section class="hero">
    <div id="featuredVideo" class="card videoCard">
      <!-- Dynamically populated -->
      <div class="thumb">
        <span class="badge">Featured • Long</span>
        <span class="pill">Loading...</span>
      </div>
      <div class="vBody">
        <div class="kicker">Latest Focus</div>
        <h2 class="h-title">Loading...</h2>
        <p class="p">Loading content...</p>
      </div>
    </div>

    <!-- RIGHT PANEL: quick browse -->
    <aside class="card pad">
      <div class="kicker">Browse</div>
      <h2 style="margin:10px 0 8px; font-size:18px;">Topics that perform well</h2>
      <p class="p">Keep categories tight. It improves navigation and sharing.</p>

      <div class="metaRow" style="margin-top:14px;">
        <span class="pill">Inflation</span>
        <span class="pill">Currency</span>
        <span class="pill">GDP & Rankings</span>
        <span class="pill">Markets</span>
        <span class="pill">Personal Finance</span>
      </div>

      <div class="searchRow">
        <input class="input" id="searchInput" placeholder="Search titles..." oninput="filterContent()" />
        <select class="select" id="typeFilter" onchange="filterContent()">
          <option value="all">All</option>
          <option value="long">Long</option>
          <option value="short">Short</option>
        </select>
      </div>

      <div class="actions">
        <a class="btn" href="explainers.html">See all explainers</a>
        <a class="btn" href="shorts.html">See all shorts</a>
      </div>
    </aside>
  </section>

  <!-- LATEST LONG -->
  <div class="sectionTitle">
    <h2>Latest Explainers</h2>
    <a href="explainers.html">View all</a>
  </div>
  <section id="latestExplainers" class="cards">
    <!-- Dynamically populated -->
  </section>

  <!-- LATEST SHORTS -->
  <div class="sectionTitle">
    <h2>Latest Shorts</h2>
    <a href="shorts.html">View all</a>
  </div>
  <section id="latestShorts" class="cards">
    <!-- Dynamically populated -->
  </section>

  <footer class="footer">
    <div>© <span id="y"></span> TALKCA • Finance • Data • Intelligence</div>
    <div style="display:flex; gap:10px; flex-wrap:wrap;">
      <a class="pill" href="https://www.youtube.com/" target="_blank" rel="noopener">YouTube</a>
      <a class="pill" href="#" target="_blank" rel="noopener">Instagram</a>
      <a class="pill" href="#" target="_blank" rel="noopener">X</a>
    </div>
  </footer>

</main>

<script>
// ============================================
// DATA LOADING
// ============================================
let allVideos = [];

// Try to load from localStorage first (admin saves here)
// Then fallback to videos.json file
async function loadVideos() {
  // Check localStorage first (for admin-managed content)
  const localData = localStorage.getItem('talkca_videos');
  if (localData) {
    allVideos = JSON.parse(localData);
    renderPage();
    return;
  }
  
  // Fallback: fetch from JSON file
  try {
    const response = await fetch('data/videos.json');
    if (response.ok) {
      allVideos = await response.json();
      // Also save to localStorage for consistency
      localStorage.setItem('talkca_videos', JSON.stringify(allVideos));
    }
  } catch (e) {
    console.log('Could not load videos.json, using defaults');
    allVideos = getDefaultVideos();
  }
  
  renderPage();
}

function getDefaultVideos() {
  return [
    {
      id: 'v1',
      title: 'The $1 Salary Problem: When Money Stops Working',
      url: 'https://www.youtube.com/',
      type: 'long',
      topic: 'Inflation',
      duration: '8-10 min',
      date: '2026-01-08',
      description: 'A clean breakdown of how inflation, controls, and currency collapse destroy purchasing power.',
      featured: true
    }
  ];
}

// ============================================
// RENDERING
// ============================================
function renderPage() {
  renderFeatured();
  renderLatestExplainers();
  renderLatestShorts();
}

function renderFeatured() {
  const featured = allVideos.find(v => v.featured) || allVideos[0];
  if (!featured) return;
  
  const container = document.getElementById('featuredVideo');
  const typeLabel = featured.type === 'long' ? 'Long' : 'Short';
  
  container.innerHTML = `
    <div class="thumb">
      <span class="badge">Featured • ${typeLabel}</span>
      <span class="pill">${featured.duration || '5-10 min'}</span>
    </div>
    <div class="vBody">
      <div class="kicker">Latest Focus</div>
      <h2 class="h-title">${featured.title}</h2>
      <p class="p">${featured.description}</p>
      <div class="metaRow">
        <span class="pill">Topic: ${featured.topic}</span>
        <span class="pill">Updated: ${featured.date}</span>
        <span class="pill">Format: Visual explainers</span>
      </div>
      <div class="actions">
        <a class="btn primary" href="${featured.url}" target="_blank" rel="noopener">Watch on YouTube</a>
        <a class="btn" href="video.html?id=${featured.id}">Open the write-up</a>
      </div>
    </div>
  `;
}

function renderLatestExplainers() {
  const explainers = allVideos
    .filter(v => v.type === 'long')
    .sort((a, b) => new Date(b.date) - new Date(a.date))
    .slice(0, 3);
  
  const container = document.getElementById('latestExplainers');
  container.innerHTML = explainers.map(video => createVideoCard(video)).join('');
}

function renderLatestShorts() {
  const shorts = allVideos
    .filter(v => v.type === 'short')
    .sort((a, b) => new Date(b.date) - new Date(a.date))
    .slice(0, 3);
  
  const container = document.getElementById('latestShorts');
  container.innerHTML = shorts.map(video => createVideoCard(video, true)).join('');
}

function createVideoCard(video, isShort = false) {
  const badgeClass = isShort ? 'badge short' : 'badge';
  const badgeText = isShort ? 'Short' : 'Long';
  const linkUrl = isShort ? video.url : `video.html?id=${video.id}`;
  const target = isShort ? 'target="_blank" rel="noopener"' : '';
  
  return `
    <a class="card videoCard" href="${linkUrl}" ${target}>
      <div class="thumb"><span class="${badgeClass}">${badgeText}</span></div>
      <div class="vBody">
        <h3>${video.title}</h3>
        <p>${video.description}</p>
      </div>
    </a>
  `;
}

// ============================================
// SEARCH / FILTER
// ============================================
function filterContent() {
  const query = document.getElementById('searchInput').value.toLowerCase();
  const type = document.getElementById('typeFilter').value;
  
  let filtered = allVideos;
  
  if (type !== 'all') {
    filtered = filtered.filter(v => v.type === type);
  }
  
  if (query) {
    filtered = filtered.filter(v => 
      v.title.toLowerCase().includes(query) || 
      v.description.toLowerCase().includes(query)
    );
  }
  
  // Re-render with filtered content
  const explainers = filtered.filter(v => v.type === 'long').slice(0, 3);
  const shorts = filtered.filter(v => v.type === 'short').slice(0, 3);
  
  document.getElementById('latestExplainers').innerHTML = 
    explainers.length ? explainers.map(v => createVideoCard(v)).join('') : '<p class="note">No explainers found.</p>';
  
  document.getElementById('latestShorts').innerHTML = 
    shorts.length ? shorts.map(v => createVideoCard(v, true)).join('') : '<p class="note">No shorts found.</p>';
}

// ============================================
// INIT
// ============================================
document.getElementById('y').textContent = new Date().getFullYear();
loadVideos();
</script>
</body>
</html>
