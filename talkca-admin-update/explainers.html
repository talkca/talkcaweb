<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>TALKCA • Explainers</title>
  <link rel="stylesheet" href="assets/site.css">
</head>
<body>

<header class="topbar">
  <div class="brand">
    <div class="mark">T</div>
    <div>
      <h1>TALKCA</h1>
      <small>Explainers (Long)</small>
    </div>
  </div>
  <nav class="nav">
    <a href="index.html">Home</a>
    <a class="active" href="explainers.html">Explainers</a>
    <a href="shorts.html">Shorts</a>
  </nav>
</header>

<main class="container">

  <div class="card pad">
    <div class="kicker">Library</div>
    <h2 style="margin:10px 0 6px;">All Explainers</h2>
    <p class="p">Each video has a short write-up so viewers can understand the thesis before watching.</p>

    <div class="searchRow">
      <input class="input" id="searchInput" placeholder="Search explainers..." oninput="filterVideos()" />
      <select class="select" id="topicFilter" onchange="filterVideos()">
        <option value="all">All topics</option>
        <option value="Inflation">Inflation</option>
        <option value="Currency">Currency</option>
        <option value="GDP & Rankings">GDP & Rankings</option>
        <option value="Markets">Markets</option>
        <option value="Personal Finance">Personal Finance</option>
      </select>
      <select class="select" id="sortOrder" onchange="filterVideos()">
        <option value="newest">Sort: Newest</option>
        <option value="oldest">Sort: Oldest</option>
      </select>
    </div>
  </div>

  <div class="sectionTitle">
    <h2>Explainers <span id="videoCount" style="color:var(--muted); font-weight:normal;"></span></h2>
    <a href="index.html">Back to home</a>
  </div>

  <section id="videoGrid" class="cards">
    <!-- Dynamically populated -->
  </section>

  <footer class="footer">
    <div>© <span id="y"></span> TALKCA • Finance • Data • Intelligence</div>
    <div><a class="pill" href="index.html">Home</a></div>
  </footer>

</main>

<script>
// ============================================
// DATA LOADING
// ============================================
let allVideos = [];

async function loadVideos() {
  // Check localStorage first
  const localData = localStorage.getItem('talkca_videos');
  if (localData) {
    allVideos = JSON.parse(localData);
    filterVideos();
    return;
  }
  
  // Fallback: fetch from JSON file
  try {
    const response = await fetch('data/videos.json');
    if (response.ok) {
      allVideos = await response.json();
      localStorage.setItem('talkca_videos', JSON.stringify(allVideos));
    }
  } catch (e) {
    console.log('Could not load videos.json');
    allVideos = [];
  }
  
  filterVideos();
}

// ============================================
// FILTERING & RENDERING
// ============================================
function filterVideos() {
  const query = document.getElementById('searchInput').value.toLowerCase();
  const topic = document.getElementById('topicFilter').value;
  const sort = document.getElementById('sortOrder').value;
  
  // Filter to explainers only
  let filtered = allVideos.filter(v => v.type === 'long');
  
  // Apply topic filter
  if (topic !== 'all') {
    filtered = filtered.filter(v => v.topic === topic);
  }
  
  // Apply search
  if (query) {
    filtered = filtered.filter(v => 
      v.title.toLowerCase().includes(query) || 
      v.description.toLowerCase().includes(query)
    );
  }
  
  // Apply sort
  filtered.sort((a, b) => {
    const dateA = new Date(a.date);
    const dateB = new Date(b.date);
    return sort === 'newest' ? dateB - dateA : dateA - dateB;
  });
  
  renderVideos(filtered);
}

function renderVideos(videos) {
  const container = document.getElementById('videoGrid');
  const countEl = document.getElementById('videoCount');
  
  countEl.textContent = `(${videos.length})`;
  
  if (videos.length === 0) {
    container.innerHTML = `
      <div class="card pad" style="grid-column: 1 / -1;">
        <p class="p">No explainers found matching your criteria.</p>
      </div>
    `;
    return;
  }
  
  container.innerHTML = videos.map(video => `
    <a class="card videoCard" href="video.html?id=${video.id}">
      <div class="thumb">
        <span class="badge">Long</span>
        <span class="pill">${video.topic}</span>
      </div>
      <div class="vBody">
        <h3>${video.title}</h3>
        <p>${video.description}</p>
        <div class="metaRow" style="margin-top:8px;">
          <span class="pill" style="font-size:11px;">${video.duration || '5-10 min'}</span>
          <span class="pill" style="font-size:11px;">${video.date}</span>
        </div>
      </div>
    </a>
  `).join('');
}

// ============================================
// INIT
// ============================================
document.getElementById('y').textContent = new Date().getFullYear();
loadVideos();
</script>
</body>
</html>
